<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap">
    <script src="https://cdn.jsdelivr.net/npm/fireworks-js/dist/fireworks.min.js"></script>

    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }

        body {
            height: 100vh;
            display: flex;
            background-color: rgba(0, 0, 0, 0.4);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .memory-game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: white;
            padding: 20px;
            border: 2px solid #801ED7;
            border-radius: 10px;
            text-align: center;
            margin-top: -10%;
        }

        .memory-game-container p {
            margin-bottom: 30px;
            font-size: 28px;
            color: #801ED7;
            font-family: 'Pacifico', cursive;
        }

        .memory-game-container p i {
            margin-right: 5px;
        }

        .memory-game {
            width: 480px;
            height: 240px;
            display: flex;
            flex-wrap: wrap;
            perspective: 1000px;
            margin-bottom: 35px;
        }

        .memory-card {
            width: calc(25% - 10px);
            height: calc(50% - 10px);
            margin: 5px;
            position: relative;
            transform: scale(1);
            transform-style: preserve-3d;
            transition: transform 0.5s;
            background-color: white;
            border: 2px solid #801ED7;
            border-radius: 15px;
        }

        .memory-card:active {
            transform: scale(0.97);
            transition: transform 0.2s;
        }

        .memory-card.flip {
            transform: rotateY(180deg);
        }

        .front-face {
            background-color: #801ED7;
            width: 100%;
            height: 100%;
            padding: 20px;
            position: absolute;
            border-radius: 10px;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: white;
        }

        .back-face {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .back-face img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 5px;
        }

        .text {
            font-size: 28px;
        }

        .front-face img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 5px;
        }

        .close-button {
            background-color: #FF6666;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 4px 15px;
            font-size: 20px;
            cursor: pointer;
            font-family: 'Pacifico', cursive;
            display: flex;
            align-items: center;
            border: 2px solid #FF6666;
        }

        .close-button i {
            margin-right: 5px;
        }

        .close-button:hover {
            background-color: white;
            color: #FF6666;
            border: 2px solid #FF6666;
        }

        .hide {
            display: none !important;
        }

        .promo-code {
            width: 480px;
            height: 240px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 35px;
        }

        .promo-code-text {
            font-size: 24px;
            color: #801ED7;
            font-family: 'Pacifico', cursive;
        }

        .promo-code-container {
            border: 2px dashed #801ED7;
            border-radius: 10px;
            background-color: #f9f9f9;
            padding: 20px;
        }

        .promo-code-value {
            font-size: 40px;
            color: #801ED7;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }

        .fireworks-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0);
            z-index: 999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 2.5s ease;
        }

        .fireworks-overlay.fade-out {
            opacity: 0;
        }

        .fireworks-overlay canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="fireworks-overlay hide"></div>
    <div class="memory-game-container">
        <p class="text"><i class="fas fa-gamepad"></i> Find all the matching pairs to unlock a promo code! <i class="fas fa-gift"></i></p>
        <div class="memory-game"></div>
        <div class="promo-code hide">
            <div class="promo-code-container">
                <div class="promo-code-value"><strong>ELGYP29E</strong></div>
            </div>
        </div>
        <button class="close-button" onclick="brazeBridge.closeMessage()"><i class="fas fa-times"></i> Close</button>
    </div>

    <script>
        const cardsArray = [
            'torchie_flag.png',
            'torchie_flag.png',
            'torchie_heart.png',
            'torchie_heart.png',
            'torchie_laugh.png',
            'torchie_laugh.png',
            'torchie_sunglasses.png',
            'torchie_sunglasses.png',
        ];

        const gameBoard = document.querySelector('.memory-game');
        let hasFlippedCard = false;
        let lockBoard = false;
        let firstCard, secondCard;

        let cardsFlipped = 0;

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createBoard() {
            const shuffledCards = shuffle(cardsArray);
            shuffledCards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.classList.add('memory-card');
                cardElement.innerHTML = `
                    <div class="front-face">
                        <img src="logo.png" alt="Front Image">
                    </div>
                    <div class="back-face">
                        <img src="${card}" alt="back Image">
                    </div>
                `;
                cardElement.addEventListener('click', flipCard);
                gameBoard.appendChild(cardElement);
            });
        }

        function flipCard() {
            if (lockBoard) return;
            if (this === firstCard) return;

            this.classList.add('flip');

            if (!hasFlippedCard) {
                hasFlippedCard = true;
                firstCard = this;
                return;
            }

            secondCard = this;
            checkForMatch();
        }

        function checkForMatch() {
            let isMatch = firstCard.querySelector('.back-face img').src === secondCard.querySelector('.back-face img').src;
            isMatch ? disableCards() : unflipCards();
        }

        function disableCards() {
            firstCard.removeEventListener('click', flipCard);
            secondCard.removeEventListener('click', flipCard);
            cardsFlipped += 2;

            resetBoard();
        }

        function unflipCards() {
            lockBoard = true;
            setTimeout(() => {
                firstCard.classList.remove('flip');
                secondCard.classList.remove('flip');
                resetBoard();
            }, 1500);
        }

        function resetBoard() {
            if (cardsFlipped === cardsArray.length) {
                const overlay = document.querySelector('.fireworks-overlay');
                overlay.classList.remove('hide');

                const fireworks = new Fireworks(overlay);
                fireworks.start();

                const fireworksDuration = 2000;
                const fadeOutDuration = 2500;

                setTimeout(() => {
                    overlay.classList.add('fade-out');
                    document.querySelector('.memory-game').classList.add("hide");
                    document.querySelector('.promo-code').classList.remove("hide");

                    setTimeout(() => {
                        fireworks.stop();
                        overlay.classList.add('hide');
                    }, fadeOutDuration);
                }, fireworksDuration);

                return;
            }

            [hasFlippedCard, lockBoard] = [false, false];
            [firstCard, secondCard] = [null, null];
        }

        createBoard();
    </script>
</body>
</html>